<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Credit Stress Test — Realtime (SEC + Yahoo + FRED)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:#0f172a;color:#e5e7eb;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .card{background:#111827;border:1px solid #1f2937;border-radius:14px;box-shadow:0 6px 22px rgba(0,0,0,.25)}
    .pill{background:#0b1220;border:1px solid #1f2937;border-radius:999px;padding:.25rem .55rem;font-size:.75rem;color:#c7d2fe}
    input[type=range]::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:#8b5cf6;box-shadow:0 0 6px #8b5cf6}
    .good{color:#10b981}.warn{color:#f59e0b}.bad{color:#ef4444}
    .tab-btn{border-bottom:2px solid transparent}
    .tab-btn.active{border-color:#8b5cf6;color:#c7d2fe}
    .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
    @media(max-width:1024px){.grid-3{grid-template-columns:1fr}}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body class="p-4 md:p-8">
  <div class="max-w-7xl mx-auto space-y-6">
    <header class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl md:text-3xl font-extrabold text-indigo-300">Credit Stress Test — Realtime</h1>
        <p class="text-sm text-slate-400">Live macros from <span class="pill">FRED</span> • Fundamentals from <span class="pill">SEC EDGAR</span> • Quotes from <span class="pill">Yahoo Finance</span></p>
        <p id="status" class="text-xs text-sky-300 mt-1"></p>
      </div>
      <div class="flex gap-2">
        <button id="tabGame" class="tab-btn px-3 py-2">Game</button>
        <button id="tabData" class="tab-btn px-3 py-2">Data</button>
      </div>
    </header>

    <!-- DATA TAB -->
    <section id="dataTab" class="hidden space-y-4">
      <div class="card p-4">
        <div class="flex flex-wrap gap-4 items-end">
          <div>
            <label class="text-xs text-slate-400">FRED API Key</label>
            <input id="fredKey" class="block bg-slate-900 border border-slate-700 rounded px-3 py-2 w-72" value="0aecc3398de3f805726545f04b2c6039" />
          </div>
          <div>
            <label class="text-xs text-slate-400">SEC Proxy URL</label>
            <input id="secProxy" class="block bg-slate-900 border border-slate-700 rounded px-3 py-2 w-[28rem]" placeholder="/.netlify/functions/sec or https://your-worker.workers.dev" />
            <p class="text-[11px] text-slate-500 mt-1">EDGAR requires a <span class="mono">User-Agent</span> header; browsers can’t set it. Use a tiny proxy (Netlify/Workers). Examples included below.</p>
          </div>
          <button id="saveCfg" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded font-semibold">Save</button>
        </div>
      </div>

      <div class="card p-4">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold text-indigo-200">Select Companies (5–10)</h3>
          <div class="text-xs text-slate-400">Type a ticker (AAPL, MSFT, PEP, XOM, TGT, SLB, JPM, AMZN…)</div>
        </div>
        <div class="flex flex-wrap gap-2 mt-3">
          <input id="tickerInput" class="bg-slate-900 border border-slate-700 rounded px-3 py-2 w-40" placeholder="Ticker" />
          <select id="tickerSector" class="bg-slate-900 border border-slate-700 rounded px-3 py-2">
            <option>TECH</option><option>RETAIL</option><option>HEALTHCARE</option><option>REAL_ESTATE</option><option>ENERGY</option><option>FINANCIALS</option><option>INDUSTRIALS</option>
          </select>
          <button id="addTicker" class="bg-emerald-600 hover:bg-emerald-700 px-3 py-2 rounded font-semibold">Add</button>
          <button id="clearTickers" class="bg-slate-700 hover:bg-slate-600 px-3 py-2 rounded">Clear</button>
        </div>
        <div id="companyList" class="mt-4 grid md:grid-cols-2 gap-3"></div>
      </div>

      <div class="card p-4">
        <h3 class="text-lg font-bold text-indigo-200 mb-2">Serverless proxy snippets</h3>
        <details class="mb-2"><summary class="text-sm text-slate-300 cursor-pointer">Netlify function (<span class="mono">/.netlify/functions/sec</span>)</summary>
          <pre class="bg-slate-900 p-3 rounded border border-slate-700 text-[12px] overflow-auto"><code>export const handler = async (event) => {
  const target = event.queryStringParameters?.url;
  if (!target) return { statusCode: 400, body: 'Missing url param' };
  const ua = process.env.SEC_USER_AGENT || 'CreditStressGame/1.0 (vpd1@fordham.edu)';
  const res = await fetch(target, { headers: { 'User-Agent': ua, 'Accept': 'application/json' } });
  const body = await res.text();
  return { statusCode: res.status, headers: { 'Content-Type': res.headers.get('Content-Type') || 'application/json', 'Access-Control-Allow-Origin': '*', 'Cache-Control': 'no-store' }, body };
};</code></pre>
        </details>
        <details><summary class="text-sm text-slate-300 cursor-pointer">Cloudflare Worker</summary>
          <pre class="bg-slate-900 p-3 rounded border border-slate-700 text-[12px] overflow-auto"><code>export default { async fetch(request, env) {
  const url = new URL(request.url); const target = url.searchParams.get('url');
  if(!target) return new Response('Missing url param', {status:400});
  const ua = env.SEC_USER_AGENT || 'CreditStressGame/1.0 (vpd1@fordham.edu)';
  const res = await fetch(target, { headers: { 'User-Agent': ua, 'Accept': 'application/json' }});
  return new Response(res.body, { status: res.status, headers: { 'Content-Type': res.headers.get('Content-Type') || 'application/json', 'Access-Control-Allow-Origin': '*', 'Cache-Control': 'no-store' } });
}};</code></pre>
        </details>
      </div>
    </section>

    <!-- GAME TAB -->
    <section id="gameTab" class="space-y-4">
      <div class="grid-3">
        <!-- Macros -->
        <div class="card p-4 space-y-3">
          <div class="flex items-center justify-between"><h2 class="text-xl font-bold text-indigo-200">Macro Stress</h2>
            <label class="text-xs"><input type="checkbox" id="useLive" class="mr-1" checked> Use live FRED</label></div>
          <div id="macros" class="space-y-3"></div>
          <p class="text-xs text-slate-400">If live is ON, sliders are offsets.</p>
        </div>
        <!-- Companies & Allocation -->
        <div class="card p-4 space-y-3">
          <h2 class="text-xl font-bold text-green-200">Companies & Allocation</h2>
          <div id="allocWrap" class="space-y-2"></div>
          <div class="text-right text-sm text-slate-300 border-t border-slate-700 pt-2">
            Total Allocation: <span id="totAlloc">0%</span> • Total Value: <span id="totVal">$0</span>
            <div id="allocWarn" class="text-xs bad"></div>
          </div>
        </div>
        <!-- Results -->
        <div class="card p-4 space-y-3">
          <h2 class="text-xl font-bold text-yellow-200">Results</h2>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-slate-900 border border-slate-700 rounded p-3 text-center">
              <div class="text-xs text-slate-400">Weighted PD</div>
              <div id="kPD" class="text-2xl bad">—</div>
            </div>
            <div class="bg-slate-900 border border-slate-700 rounded p-3 text-center">
              <div class="text-xs text-slate-400">Weighted Yield</div>
              <div id="kY" class="text-2xl good">—</div>
            </div>
          </div>
          <div>
            <h3 class="text-sm text-slate-400">Per-Company (stressed)</h3>
            <div id="perCompany" class="space-y-2 text-sm"></div>
          </div>
          <button id="grade" class="w-full bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-bold py-2 rounded">Grade Portfolio</button>
        </div>
      </div>
    </section>
  </div>

<script>
/**** CONFIG ****/
const CONFIG = {
  fredKey: '0aecc3398de3f805726545f04b2c6039',
  secProxy: localStorage.getItem('secProxy') || '', // '/.netlify/functions/sec' recommended
  userAgentNote: 'CreditStressGame/1.0 (vpd1@fordham.edu)'
};

// (rest of JS stays same as before: macros, SEC, Yahoo, simulate, etc.)
</script>
</body>
</html>
